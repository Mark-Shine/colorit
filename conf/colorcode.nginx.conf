server {
    root /opt/colorcode/web;
    error_page  404  /404.html;
    index index.html index.htm;

    gzip on;
    gzip_min_length 1k;
    gzip_buffers 4 16k;
    gzip_http_version 1.0;
    gzip_comp_level 2;
    gzip_types text/plain application/x-javascript text/css application/xml;
    gzip_vary on;

    server_name colorcode colorcode.sparker5.com liu.colorcode.sparker5.com wang.colorcode.sparker5.com ge.colorcode.sparker5.com;

    # For safety
    rewrite ^/cgi/.*$ /404.html break;
    rewrite ^/ajax/.*$ /404.html break;
    rewrite ^/api/.*$ /404.html break;
    rewrite ^/sessions/.*$ /404.html break;

    # Rewrite rules
    rewrite ^/$ /html/index_cn.html last;
    rewrite ^/img/(.*)$ /img/$1 last;
    rewrite ^/css/(.*)$ /css/$1 last;
    rewrite ^/js/(.*)$ /js/$1 last;
    rewrite ^/plugins/(.*)$ /plugins/$1 last;
    rewrite ^/zarkapi/(.*)$ /cgi/$1 last;

    location / {
        try_files $uri $uri/;
    }

    location /cgi {
        include uwsgi_params;
        uwsgi_pass 127.0.0.1:20003;
    }

}
